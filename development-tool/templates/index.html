<html>
  <head>
    {{ codemirror.include_codemirror() }}
    <meta charset='utf-8' /> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>OPENPIBO-IDE</title>
    <link rel="shortcut icon" href="../static/icon.png" type="image/x-icon" />
    <script src="../static/socket.io.js"></script>
    <script src="../static/jquery-3.1.1.min.js"></script>
    <script>
      $(function(){
        const socket = io();

	$('#stop').click(function(){
	  socket.emit('stop');
	});
	
	$('#show').click(function(){
	  socket.emit('show');
	});

	socket.on("show", function(data){
          $("#image").attr(
            "src",
            "data:image/jpeg;charset=utf-8;base64," + data
          );
	});
	
	$('#code_form').on("submit", function(event){
          event.preventDefault();
          socket.emit('compile', $(this).find('[name=source_code]').val())
	});

	socket.on('updatelog', function(data){
          $("#updatelog").text(data) 
	  const top = $('#updatelog').prop('scrollHeight');
	  $('#updatelog').scrollTop(top);
        });
      });
    </script>
    <style type="text/css">
      @font-face {
        font-family: 'DungGeunMo';
        src: url("../static/DungGeunMo.woff") format('woff');
        font-weight: normal;
        font-style: normal;
      }
      input{font-family: 'DungGeunMo';}
      button{font-family: 'DungGeunMo';}
      textarea{font-family: 'DungGeunMo';}
      body{
        font-family: 'DungGeunMo';
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Openpibo IDE</h1>
    </header>

    <h4>
      <button type="submit" form="code_form" style="width:100px;">Run</button>
      <button id='stop' style="width:100px;">Stop</button>
      <button id="show" style="width:100px;">View</button>
      <i>[filepath: {{ form.codepath }}, {{ form.imgpath }}]</i>
    </h4>
    
    <h3># Editor</h3>
    <div style="border:1px dotted;border-radius:5px;padding:5px">
      <form id='code_form'> {{ form.source_code }} </form>
    </div>

    <div style="width:100%;height:400px">
      <div style="width:calc(100% - 420px);height:400px;float:left">
        <h3># Output[Log]</h3>
        <textarea id='updatelog' style="border:1px dotted;border-radius:5px;padding:5px;width:100%;height:300px" disabled></textarea> 
      </div>
      <div style="width:400px;height:400px;float:right">
        <h3># Output[Image]</h3>
        <img id='image' width="400" height="300" style="border:1px dotted;border-radius:5px" />
      </div>
    </div>
   
    <footer style="bottom:0;text-align:center;width:100%;margin:40px auto 20px">Â© Copyright 2022, Circulus Education - THE MAKER</footer>
  </body>
</html>
